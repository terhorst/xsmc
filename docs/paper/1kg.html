
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>1000 Genomes analysis &#8212; xsmc 1.0.3.dev0+gfd916e6.d20201021 documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API: xsmc package" href="../xsmc.html" />
    <link rel="prev" title="Comparison of XSMC and PSMC" href="psmc.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../xsmc.html" title="API: xsmc package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="psmc.html" title="Comparison of XSMC and PSMC"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">xsmc 1.0.3.dev0+gfd916e6.d20201021 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Reproducible figures and tables from paper</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">1000 Genomes analysis</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container,
div.nbinput.container div.prompt,
div.nbinput.container div.input_area,
div.nbinput.container div[class*=highlight],
div.nbinput.container div[class*=highlight] pre,
div.nboutput.container,
div.nboutput.container div.prompt,
div.nboutput.container div.output_area,
div.nboutput.container div[class*=highlight],
div.nboutput.container div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="1000-Genomes-analysis">
<h1>1000 Genomes analysis<a class="headerlink" href="#1000-Genomes-analysis" title="Permalink to this headline">¶</a></h1>
<p>The tree sequence files for 1kg are available <a class="reference external" href="https://zenodo.org/record/3051855">here</a>. The other metadata files are part of the public 1kg release.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">tskit</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">xsmc</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">as_completed</span><span class="p">,</span> <span class="n">ProcessPoolExecutor</span>
<span class="kn">from</span> <span class="nn">xsmc.supporting.kde_ne</span> <span class="kn">import</span> <span class="n">kde_ne</span>
<span class="kn">from</span> <span class="nn">xsmc.supporting.plotting</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;xsmc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">PAPER_ROOT</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PAPER_ROOT&quot;</span><span class="p">,</span> <span class="s2">&quot;.&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 2;
                var nbb_unformatted_code = "import os\nimport tskit\nimport numpy as np\nimport xsmc\nimport matplotlib.pyplot as plt\nfrom concurrent.futures import ThreadPoolExecutor, as_completed, ProcessPoolExecutor\nfrom xsmc.supporting.kde_ne import kde_ne\nfrom xsmc.supporting.plotting import *\nimport logging\nimport os\n\n\nlogging.getLogger(\"xsmc\").setLevel(logging.INFO)\nPAPER_ROOT = os.path.expanduser(os.environ.get(\"PAPER_ROOT\", \".\"))";
                var nbb_formatted_code = "import os\nimport tskit\nimport numpy as np\nimport xsmc\nimport matplotlib.pyplot as plt\nfrom concurrent.futures import ThreadPoolExecutor, as_completed, ProcessPoolExecutor\nfrom xsmc.supporting.kde_ne import kde_ne\nfrom xsmc.supporting.plotting import *\nimport logging\nimport os\n\n\nlogging.getLogger(\"xsmc\").setLevel(logging.INFO)\nPAPER_ROOT = os.path.expanduser(os.environ.get(\"PAPER_ROOT\", \".\"))";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">seed</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 3;
                var nbb_unformatted_code = "np.random.seed(1)\n\n\ndef seed():\n    return np.random.randint(1, np.iinfo(np.int32).max)";
                var nbb_formatted_code = "np.random.seed(1)\n\n\ndef seed():\n    return np.random.randint(1, np.iinfo(np.int32).max)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">full_chroms</span> <span class="o">=</span> <span class="p">[</span><span class="n">tskit</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/scratch/1kg/trees/1kg_chr</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.trees&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">)]</span>
<span class="c1"># chr1 = chr1.delete_intervals([[0, 16e6]], simplify=False).trim()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 4;
                var nbb_unformatted_code = "full_chroms = [tskit.load(f\"/scratch/1kg/trees/1kg_chr{i}.trees\") for i in range(1, 23)]\n# chr1 = chr1.delete_intervals([[0, 16e6]], simplify=False).trim()";
                var nbb_formatted_code = "full_chroms = [tskit.load(f\"/scratch/1kg/trees/1kg_chr{i}.trees\") for i in range(1, 23)]\n# chr1 = chr1.delete_intervals([[0, 16e6]], simplify=False).trim()";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="section" id="Accessibility-masking">
<h2>Accessibility masking<a class="headerlink" href="#Accessibility-masking" title="Permalink to this headline">¶</a></h2>
<p>The 1kg tree sequences feature some trees that span huge intervals. These represent centromeres, telomeres, or other inaccessible regions. To our method they appear as huge tracts of IBD, leading to downward bias in the size history estimates. To properly correct for this we should use the 1kg accessibility masks, but here I adopt the simpler approach of heuristically chopping out trees that span large segments (&gt;1Mb).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">long_spans</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">full_chroms</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">long_spans</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">interval</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">chrom</span><span class="o">.</span><span class="n">trees</span><span class="p">()</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">interval</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e6</span><span class="p">]</span>
<span class="n">long_spans</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{1: [Interval(left=121347335.0, right=142643153.0)],
 2: [Interval(left=90490322.0, right=91634056.0),
  Interval(left=92102205.0, right=95333904.0)],
 3: [Interval(left=90291128.0, right=93527692.0)],
 4: [Interval(left=49629442.0, right=52700457.0)],
 5: [Interval(left=46118241.0, right=49571959.0)],
 6: [Interval(left=58665913.0, right=61967504.0)],
 7: [Interval(left=57669630.0, right=62465883.0)],
 8: [Interval(left=43529404.0, right=47458633.0)],
 9: [Interval(left=47309856.0, right=65510886.0)],
 10: [Interval(left=39043557.0, right=42746452.0)],
 11: [Interval(left=50381334.0, right=51436554.0),
  Interval(left=51510699.0, right=55254669.0)],
 12: [Interval(left=34340941.0, right=38610698.0)],
 13: [Interval(left=0.0, right=19037838.0)],
 14: [Interval(left=0.0, right=19083007.0)],
 15: [Interval(left=0.0, right=20253797.0)],
 16: [Interval(left=35146682.0, right=46554124.0)],
 17: [Interval(left=22155426.0, right=25392232.0)],
 18: [Interval(left=15357425.0, right=18535477.0)],
 19: [Interval(left=24310556.0, right=28366182.0)],
 20: [Interval(left=26193540.0, right=29862565.0)],
 21: [Interval(left=0.0, right=9491942.0),
  Interval(left=11010799.0, right=14383028.0)],
 22: [Interval(left=0.0, right=16103536.0)]}
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 5;
                var nbb_unformatted_code = "long_spans = {}\nfor i, chrom in enumerate(full_chroms, 1):\n    long_spans[i] = [t.interval for t in chrom.trees() if np.diff(t.interval) > 1e6]\nlong_spans";
                var nbb_formatted_code = "long_spans = {}\nfor i, chrom in enumerate(full_chroms, 1):\n    long_spans[i] = [t.interval for t in chrom.trees() if np.diff(t.interval) > 1e6]\nlong_spans";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<p>Now we simply chop these intervals out. This technically allows IBD tracts to span these gaps during inference, but the effect should be minimal.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">chroms</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">chrom</span><span class="o">.</span><span class="n">delete_intervals</span><span class="p">(</span><span class="n">long_spans</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">simplify</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">trim</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">chrom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">full_chroms</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 6;
                var nbb_unformatted_code = "chroms = [\n    chrom.delete_intervals(long_spans[i], simplify=False).trim()\n    for i, chrom in enumerate(full_chroms, 1)\n]";
                var nbb_formatted_code = "chroms = [\n    chrom.delete_intervals(long_spans[i], simplify=False).trim()\n    for i, chrom in enumerate(full_chroms, 1)\n]";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># 1kg metadata</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/scratch/1kg/integrated_call_samples_v3.20130502.ALL.panel&quot;</span><span class="p">,</span> <span class="s2">&quot;rt&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">sample_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">sample_id</span><span class="p">:</span> <span class="p">(</span><span class="n">pop</span><span class="p">,</span> <span class="n">superpop</span><span class="p">)</span> <span class="k">for</span> <span class="n">sample_id</span><span class="p">,</span> <span class="n">pop</span><span class="p">,</span> <span class="n">superpop</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 7;
                var nbb_unformatted_code = "# 1kg metadata\n\nwith open(\"/scratch/1kg/integrated_call_samples_v3.20130502.ALL.panel\", \"rt\") as f:\n    next(f)\n    rows = (line.strip().split(\"\\t\") for line in f)\n    sample_map = {sample_id: (pop, superpop) for sample_id, pop, superpop, _ in rows}";
                var nbb_formatted_code = "# 1kg metadata\n\nwith open(\"/scratch/1kg/integrated_call_samples_v3.20130502.ALL.panel\", \"rt\") as f:\n    next(f)\n    rows = (line.strip().split(\"\\t\") for line in f)\n    sample_map = {sample_id: (pop, superpop) for sample_id, pop, superpop, _ in rows}";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># map each 1kg sample id ts nodes</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">samples_to_nodes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">ind</span><span class="o">.</span><span class="n">metadata</span><span class="p">)[</span><span class="s2">&quot;individual_id&quot;</span><span class="p">]:</span> <span class="n">ind</span><span class="o">.</span><span class="n">nodes</span>
    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="n">chroms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">individuals</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 8;
                var nbb_unformatted_code = "# map each 1kg sample id ts nodes\nimport json\n\nsamples_to_nodes = {\n    json.loads(ind.metadata)[\"individual_id\"]: ind.nodes\n    for ind in chroms[0].individuals()\n}";
                var nbb_formatted_code = "# map each 1kg sample id ts nodes\nimport json\n\nsamples_to_nodes = {\n    json.loads(ind.metadata)[\"individual_id\"]: ind.nodes\n    for ind in chroms[0].individuals()\n}";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">superpops</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">sample_id</span><span class="p">,</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">sp</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sample_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">superpops</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="p">[])</span>
    <span class="n">superpops</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_id</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 9;
                var nbb_unformatted_code = "superpops = {}\nfor sample_id, (p, sp) in sample_map.items():\n    superpops.setdefault(sp, [])\n    superpops[sp].append(sample_id)";
                var nbb_formatted_code = "superpops = {}\nfor sample_id, (p, sp) in sample_map.items():\n    superpops.setdefault(sp, [])\n    superpops[sp].append(sample_id)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">K</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># number of samples to take from each superpopulation</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">1.4e-8</span>  <span class="c1"># assumed mutation rate for humans</span>


<span class="k">def</span> <span class="nf">process_samples</span><span class="p">(</span><span class="n">sample_dict</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">rho_over_theta</span><span class="p">):</span>
    <span class="n">sampled_heights</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">sp</span> <span class="ow">in</span> <span class="n">sample_dict</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">sp</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sample_id</span> <span class="ow">in</span> <span class="n">sample_dict</span><span class="p">[</span><span class="n">sp</span><span class="p">][:</span><span class="n">K</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sample_id</span><span class="p">)</span>
            <span class="n">f</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">samples_to_nodes</span><span class="p">[</span><span class="n">sample_id</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">chroms</span><span class="p">:</span>
                <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">xsmc</span><span class="o">.</span><span class="n">XSMC</span><span class="p">(</span>
                        <span class="n">data</span><span class="p">,</span> <span class="n">focal</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">panel</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">w</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">rho_over_theta</span><span class="o">=</span><span class="n">rho_over_theta</span>
                    <span class="p">)</span>
                <span class="p">)</span>
        <span class="k">with</span> <span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">futs</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">p</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">.</span><span class="n">sample_heights</span><span class="p">,</span>
                    <span class="n">j</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">k</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">ts</span><span class="o">.</span><span class="n">get_sequence_length</span><span class="p">()</span> <span class="o">/</span> <span class="mi">50_000</span><span class="p">),</span>
                    <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">(),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xs</span>
            <span class="p">]</span>

        <span class="n">sampled_heights</span><span class="p">[</span><span class="n">sp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
            <span class="p">[</span><span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="o">.</span><span class="n">theta</span> <span class="o">/</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">mu</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">futs</span><span class="p">,</span> <span class="n">xs</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>  <span class="c1"># rescale each sampled path by 2N0 so that segment heights are in generations</span>
    <span class="k">return</span> <span class="n">sampled_heights</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 10;
                var nbb_unformatted_code = "K = 20  # number of samples to take from each superpopulation\nmu = 1.4e-8  # assumed mutation rate for humans\n\n\ndef process_samples(sample_dict, w, rho_over_theta):\n    sampled_heights = {}\n    lines = {}\n    for sp in sample_dict:\n        print(sp, flush=True)\n        xs = []\n        for sample_id in sample_dict[sp][:K]:\n            print(\"\\t%s\" % sample_id)\n            f, p = samples_to_nodes[sample_id]\n            for data in chroms:\n                xs.append(\n                    xsmc.XSMC(\n                        data, focal=f, panel=[p], w=w, rho_over_theta=rho_over_theta\n                    )\n                )\n        with ThreadPoolExecutor(24) as p:\n            futs = [\n                p.submit(\n                    x.sample_heights,\n                    j=100,\n                    k=int(x.ts.get_sequence_length() / 50_000),\n                    seed=seed(),\n                )\n                for x in xs\n            ]\n\n        sampled_heights[sp] = np.concatenate(\n            [f.result() * 2 * x.theta / (4 * mu) for f, x in zip(futs, xs)], axis=1\n        )  # rescale each sampled path by 2N0 so that segment heights are in generations\n    return sampled_heights";
                var nbb_formatted_code = "K = 20  # number of samples to take from each superpopulation\nmu = 1.4e-8  # assumed mutation rate for humans\n\n\ndef process_samples(sample_dict, w, rho_over_theta):\n    sampled_heights = {}\n    lines = {}\n    for sp in sample_dict:\n        print(sp, flush=True)\n        xs = []\n        for sample_id in sample_dict[sp][:K]:\n            print(\"\\t%s\" % sample_id)\n            f, p = samples_to_nodes[sample_id]\n            for data in chroms:\n                xs.append(\n                    xsmc.XSMC(\n                        data, focal=f, panel=[p], w=w, rho_over_theta=rho_over_theta\n                    )\n                )\n        with ThreadPoolExecutor(24) as p:\n            futs = [\n                p.submit(\n                    x.sample_heights,\n                    j=100,\n                    k=int(x.ts.get_sequence_length() / 50_000),\n                    seed=seed(),\n                )\n                for x in xs\n            ]\n\n        sampled_heights[sp] = np.concatenate(\n            [f.result() * 2 * x.theta / (4 * mu) for f, x in zip(futs, xs)], axis=1\n        )  # rescale each sampled path by 2N0 so that segment heights are in generations\n    return sampled_heights";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
</div>
<div class="section" id="Time-to-process-1-whole-genome">
<h2>Time to process 1 whole genome<a class="headerlink" href="#Time-to-process-1-whole-genome" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">process_samples</span><span class="p">({</span><span class="s1">&#39;test&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;NA12878&#39;</span><span class="p">]},</span> <span class="n">w</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">rho_over_theta</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
test
        NA12878
CPU times: user 7min 36s, sys: 743 ms, total: 7min 37s
Wall time: 37.8 s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 11;
                var nbb_unformatted_code = "%%time\n_ = process_samples({'test': ['NA12878']}, w=500, rho_over_theta=1.)";
                var nbb_formatted_code = "%%time\n_ = process_samples({'test': ['NA12878']}, w=500, rho_over_theta=1.)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
</div>
<div class="section" id="Main-event">
<h2>Main event<a class="headerlink" href="#Main-event" title="Permalink to this headline">¶</a></h2>
<p>Run pipeline for all 1kg samples split into 5 superpopulations</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">make_plot</span><span class="p">(</span><span class="n">sampled_heights</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sp</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sampled_heights</span><span class="p">,</span> <span class="n">TABLEAU</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sampled_heights</span><span class="p">[</span><span class="n">sp</span><span class="p">])</span>
        <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="n">futs</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">kde_ne</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">A</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">as_completed</span><span class="p">(</span><span class="n">futs</span><span class="p">):</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">x</span> <span class="o">*</span> <span class="n">g</span><span class="p">,</span> <span class="n">y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># rescale to years, plot diploid Ne</span>
        <span class="n">plot_summary</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Years ($\mu=1.4\times 10^{-8}, g=</span><span class="si">%d</span><span class="s2">$)&quot;</span> <span class="o">%</span> <span class="n">g</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Effective Population Size ($N_e$)&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PAPER_ROOT</span><span class="p">,</span> <span class="s2">&quot;figures&quot;</span><span class="p">,</span> <span class="s2">&quot;xsmc_1kg_</span><span class="si">%s</span><span class="s2">.pdf&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 12;
                var nbb_unformatted_code = "def make_plot(sampled_heights, g, name):\n    fig, ax = plt.subplots(figsize=(8, 5))\n    x0 = np.geomspace(1e2, 1e6, 1000)\n    for sp, col in zip(sampled_heights, TABLEAU):\n        lines = []\n        A = np.array(sampled_heights[sp])\n        with ProcessPoolExecutor() as p:\n            futs = [p.submit(kde_ne, a.reshape(-1)) for a in A]\n            for f in as_completed(futs):\n                x, y = f.result()\n                lines.append((x * g, y / 2))  # rescale to years, plot diploid Ne\n        plot_summary(ax, lines, x0, color=col, label=sp)\n    ax.set_xscale(\"log\")\n    ax.set_yscale(\"log\")\n    ax.legend(loc=\"lower right\")\n    ax.set_xlabel(r\"Years ($\\mu=1.4\\times 10^{-8}, g=%d$)\" % g)\n    ax.set_ylabel(\"Effective Population Size ($N_e$)\")\n    fig.tight_layout()\n    fig.savefig(os.path.join(PAPER_ROOT, \"figures\", \"xsmc_1kg_%s.pdf\" % name))\n    return fig";
                var nbb_formatted_code = "def make_plot(sampled_heights, g, name):\n    fig, ax = plt.subplots(figsize=(8, 5))\n    x0 = np.geomspace(1e2, 1e6, 1000)\n    for sp, col in zip(sampled_heights, TABLEAU):\n        lines = []\n        A = np.array(sampled_heights[sp])\n        with ProcessPoolExecutor() as p:\n            futs = [p.submit(kde_ne, a.reshape(-1)) for a in A]\n            for f in as_completed(futs):\n                x, y = f.result()\n                lines.append((x * g, y / 2))  # rescale to years, plot diploid Ne\n        plot_summary(ax, lines, x0, color=col, label=sp)\n    ax.set_xscale(\"log\")\n    ax.set_yscale(\"log\")\n    ax.legend(loc=\"lower right\")\n    ax.set_xlabel(r\"Years ($\\mu=1.4\\times 10^{-8}, g=%d$)\" % g)\n    ax.set_ylabel(\"Effective Population Size ($N_e$)\")\n    fig.tight_layout()\n    fig.savefig(os.path.join(PAPER_ROOT, \"figures\", \"xsmc_1kg_%s.pdf\" % name))\n    return fig";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%%time</span>
<span class="n">sampled_heights</span> <span class="o">=</span> <span class="n">process_samples</span><span class="p">(</span><span class="n">superpops</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">rho_over_theta</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
EUR
        HG00096
        HG00097
        HG00099
        HG00100
        HG00101
        HG00102
        HG00103
        HG00105
        HG00106
        HG00107
        HG00108
        HG00109
        HG00110
        HG00111
        HG00112
        HG00113
        HG00114
        HG00115
        HG00116
        HG00117
EAS
        HG00403
        HG00404
        HG00406
        HG00407
        HG00409
        HG00410
        HG00419
        HG00421
        HG00422
        HG00428
        HG00436
        HG00437
        HG00442
        HG00443
        HG00445
        HG00446
        HG00448
        HG00449
        HG00451
        HG00452
AMR
        HG00551
        HG00553
        HG00554
        HG00637
        HG00638
        HG00640
        HG00641
        HG00731
        HG00732
        HG00734
        HG00736
        HG00737
        HG00739
        HG00740
        HG00742
        HG00743
        HG01047
        HG01048
        HG01049
        HG01051
SAS
        HG01583
        HG01586
        HG01589
        HG01593
        HG02490
        HG02491
        HG02493
        HG02494
        HG02597
        HG02600
        HG02601
        HG02603
        HG02604
        HG02648
        HG02649
        HG02651
        HG02652
        HG02654
        HG02655
        HG02657
AFR
        HG01879
        HG01880
        HG01882
        HG01883
        HG01885
        HG01886
        HG01889
        HG01890
        HG01894
        HG01896
        HG01912
        HG01914
        HG01915
        HG01956
        HG01958
        HG01985
        HG01986
        HG01988
        HG01989
        HG01990
CPU times: user 15h 50min 50s, sys: 32.1 s, total: 15h 51min 22s
Wall time: 41min 10s
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 13;
                var nbb_unformatted_code = "%%time\nsampled_heights = process_samples(superpops, w=500, rho_over_theta=1.)";
                var nbb_formatted_code = "%%time\nsampled_heights = process_samples(superpops, w=500, rho_over_theta=1.)";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">make_plot</span><span class="p">(</span><span class="n">sampled_heights</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="s2">&quot;final&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
/home/terhorst/opt/py37/lib/python3.7/site-packages/numpy/lib/nanfunctions.py:1392: RuntimeWarning: All-NaN slice encountered
  overwrite_input, interpolation)
2020-09-21 16:03:00,023 WARNING matplotlib.font_manager MainThread findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans.
2020-09-21 16:03:00,225 WARNING matplotlib.font_manager MainThread findfont: Font family [&#39;sans-serif&#39;] not found. Falling back to DejaVu Sans.
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<img alt="../_images/paper_1kg_18_1.png" src="../_images/paper_1kg_18_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/paper_1kg_18_2.png" src="../_images/paper_1kg_18_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="output_javascript"></div>
<script type="text/javascript">
var element = document.currentScript.previousSibling.previousSibling;

            setTimeout(function() {
                var nbb_cell_id = 14;
                var nbb_unformatted_code = "make_plot(sampled_heights, 29, \"final\")";
                var nbb_formatted_code = "make_plot(sampled_heights, 29, \"final\")";
                var nbb_cells = Jupyter.notebook.get_cells();
                for (var i = 0; i < nbb_cells.length; ++i) {
                    if (nbb_cells[i].input_prompt_number == nbb_cell_id) {
                        if (nbb_cells[i].get_text() == nbb_unformatted_code) {
                             nbb_cells[i].set_text(nbb_formatted_code);
                        }
                        break;
                    }
                }
            }, 500);

</script></div>
</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">1000 Genomes analysis</a><ul>
<li><a class="reference internal" href="#Accessibility-masking">Accessibility masking</a></li>
<li><a class="reference internal" href="#Time-to-process-1-whole-genome">Time to process 1 whole genome</a></li>
<li><a class="reference internal" href="#Main-event">Main event</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="psmc.html"
                        title="previous chapter">Comparison of XSMC and PSMC</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../xsmc.html"
                        title="next chapter">API: <code class="docutils literal notranslate"><span class="pre">xsmc</span></code> package</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/paper/1kg.ipynb.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../xsmc.html" title="API: xsmc package"
             >next</a> |</li>
        <li class="right" >
          <a href="psmc.html" title="Comparison of XSMC and PSMC"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">xsmc 1.0.3.dev0+gfd916e6.d20201021 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Reproducible figures and tables from paper</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">1000 Genomes analysis</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Caleb Ki and Jonathan Terhorst.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>